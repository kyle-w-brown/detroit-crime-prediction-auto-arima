
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detroit Crime Prediction with Auto ARIMA</title>
  
  <link href="_static/css/style.css" rel="stylesheet">
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="_static/det-icon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show col-6 border-right" id="site-navigation">
    
        <div class="navbar-brand">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1 current">
 </li>
</ul>
 
    </div>
</nav> <!-- To handle the deprecated key -->

</div>



          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" >
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
      
<div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="current reference internal nav-link" href="#">
  Detroit Crime Prediction with Auto ARIMA
 </a>
</li>
</ul>
      </div>
      
    </div>            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/intro.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/kyle-w-brown/detroit-crime-prediction-auto-arima"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/kyle-w-brown/detroit-crime-prediction-auto-arima/issues/new?title=Issue%20on%20page%20%2Fintro.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen Mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/kyle-w-brown/detroit-crime-prediction-auto-arima/HEAD/v2/gh/kyle-w-brown/detroit-crime-prediction-auto-arima/master?urlpath=tree/docs/intro.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/drive/1L4OADDoNWlyZPt6kXLHZUlahUWS3Rk4E?usp=sharing/github/kyle-w-brown/detroit-crime-prediction-auto-arima/blob/master/docs/intro.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i><d>Contents</d>
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problem-statement">
     Problem Statement
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#target-objectives">
     Target Objectives
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exploring-time">
   Exploring Time
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#daily-crimes">
     Daily Crimes
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#yearly-number-of-crimes">
     Yearly Number of Crimes
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#average-monthly-crimes">
     Average Monthly Crimes
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#monthly-average-crime-breakdown">
     Monthly Average Crime Breakdown
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualization">
   Visualization
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#time-series-plot">
     Time Series Plot
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#yearly-bar-plot">
     Yearly Bar Plot
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#average-crime-histogram">
     Average Crime Histogram
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lag-plot">
     Lag Plot
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correlation">
     Correlation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#autocorrelation-plot">
     Autocorrelation Plot
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#time-series-models">
   Time Series Models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#base-sarima">
     Base SARIMA
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#base-sarimax-prediction">
       Base SARIMAX Prediction
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#base-sarima-prediction-plot">
       Base SARIMA Prediction Plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#base-sarima-forecast">
       Base SARIMA Forecast
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#single-step-sarima">
     Single-Step SARIMA
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#single-step-sarima-prediction">
       Single-Step SARIMA Prediction
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#single-step-sarima-prediction-plot">
       Single-Step SARIMA Prediction Plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#single-step-sarima-forecast">
       Single-Step SARIMA Forecast
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#autoregressive">
     AutoRegressive
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#autoregressive-prediction">
       AutoRegressive Prediction
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#autoregressive-prediction-plot">
       AutoRegressive Prediction Plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#autoregressive-forecast">
       AutoRegressive Forecast
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stepwise-auto-arima">
     Stepwise Auto ARIMA
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stepwise-auto-arima-prediction">
       Stepwise Auto ARIMA Prediction
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stepwise-auto-arima-prediction-plot">
       Stepwise Auto ARIMA Prediction Plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stepwise-auto-arima-forecast">
       Stepwise Auto ARIMA Forecast
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decomposed-auto-arima">
     Decomposed Auto ARIMA
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decomposed-auto-arima-prediction">
       Decomposed Auto ARIMA Prediction
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decomposed-auto-arima-prediction-plot">
       Decomposed Auto ARIMA Prediction Plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decomposed-auto-arima-forecast">
       Decomposed Auto ARIMA Forecast
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decomposed-sarima">
     Decomposed SARIMA
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decomposed-sarima-prediction">
       Decomposed SARIMA Prediction
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decomposed-sarima-prediction-plot">
       Decomposed SARIMA Prediction Plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decomposed-sarima-forecast">
       Decomposed SARIMA Forecast
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multi-step-decomposed-sarima">
     Multi-Step SARIMA
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#multi-step-decomposed-sarima-prediction">
       Multi-Step SARIMA Prediction
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#multi-step-decomposed-sarima-prediction-plot">
       Multi-Step SARIMA Prediction Plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#multi-step-decomposed-sarima-forecast">
       Multi-Step SARIMA Forecast
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prediction-results">
   Prediction Results
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prediction-plot-analysis">
   Prediction Plot Analysis
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#forecast-comparison">
   Forecast Comparison
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Detroit Crime Prediction with Auto ARIMA</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problem-statement">
     Problem Statement
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#target-objectives">
     Target Objectives
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exploring-time">
   Exploring Time
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#daily-crimes">
     Daily Crimes
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#yearly-number-of-crimes">
     Yearly Number of Crimes
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#average-monthly-crimes">
     Average Monthly Crimes
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#monthly-average-crime-breakdown">
     Monthly Average Crime Breakdown
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualization">
   Visualization
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#time-series-plot">
     Time Series Plot
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#yearly-bar-plot">
     Yearly Bar Plot
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#average-crime-histogram">
     Average Crime Histogram
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lag-plot">
     Lag Plot
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correlation">
     Correlation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#autocorrelation-plot">
     Autocorrelation Plot
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#time-series-models">
   Time Series Models
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#training-and-testing-split">
     Training and Testing Split
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stationary-check">
     Stationary Check
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stationary-difference">
     Stationary Difference
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#difference-to-stationary-plot">
       Difference to Stationary Plot
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#autocorrelation-p-d-q-selection">
     Autocorrelation
     <code class="docutils literal notranslate">
      <span class="pre">
       (p,d,q)
      </span>
     </code>
     Selection
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#base-sarima">
     Base SARIMA
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#base-sarimax-prediction">
       Base SARIMAX Prediction
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#base-sarima-prediction-plot">
       Base SARIMA Prediction Plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#base-sarima-forecast">
       Base SARIMA Forecast
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#single-step-sarima">
     Single-Step SARIMA
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#single-step-sarima-prediction">
       Single-Step SARIMA Prediction
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#single-step-sarima-prediction-plot">
       Single-Step SARIMA Prediction Plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#single-step-sarima-forecast">
       Single-Step SARIMA Forecast
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#autoregressive">
     AutoRegressive
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#autoregressive-prediction">
       AutoRegressive Prediction
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#autoregressive-prediction-plot">
       AutoRegressive Prediction Plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#autoregressive-forecast">
       AutoRegressive Forecast
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stepwise-auto-arima">
     Stepwise Auto ARIMA
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stepwise-auto-arima-prediction">
       Stepwise Auto ARIMA Prediction
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stepwise-auto-arima-prediction-plot">
       Stepwise Auto ARIMA Prediction Plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stepwise-auto-arima-forecast">
       Stepwise Auto ARIMA Forecast
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#seasonal-decomposition-analysis">
     Seasonal Decomposition Analysis
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trend-stationary-check">
       Trend Stationary Check
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decomposed-auto-arima">
     Decomposed Auto ARIMA
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#seasonal-stationary-check">
       Seasonal Stationary Check
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decomposed-auto-arima-prediction">
       Decomposed Auto ARIMA Prediction
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decomposed-auto-arima-prediction-plot">
       Decomposed Auto ARIMA Prediction Plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decomposed-auto-arima-forecast">
       Decomposed Auto ARIMA Forecast
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#seasonal-decomposition-additive-analysis">
       Seasonal Decomposition Additive Analysis
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decomposed-sarima">
     Decomposed SARIMA
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decomposed-sarima-prediction">
       Decomposed SARIMA Prediction
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decomposed-sarima-prediction-plot">
       Decomposed SARIMA Prediction Plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decomposed-sarima-forecast">
       Decomposed SARIMA Forecast
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multi-step-decomposed-sarima">
     Multi-Step Decomposed SARIMA
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#multi-step-decomposed-sarima-prediction">
       Multi-Step Decomposed SARIMA Prediction
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#multi-step-decomposed-sarima-prediction-plot">
       Multi-Step Decomposed SARIMA Prediction Plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#multi-step-decomposed-sarima-forecast">
       Multi-Step Decomposed SARIMA Forecast
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prediction-results">
   Prediction Results
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prediction-plot-analysis">
   Prediction Plot Analysis
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#forecast-comparison">
   Forecast Comparison
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="detroit-crime-prediction-with-auto-arima">
<p><em>By: Kyle W. Brown</em></p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>Analyzing crime has become a popular analysis among enthusiasts, academics, data scientists, and the law enforcement community. With the explosion of crimes across the United States since the pandemic, predicting crime has never been more relevant. The City of Detroit is no stranger to crime, being one of the most dangerous cities in the United States for over the last five decades. The goal of this project is to provide an accurate Time Series analysis and forecast of crime in Detroit from 2017 until now.</p>
<div class="section" id="problem-statement">
<h2>Problem Statement<a class="headerlink" href="#problem-statement" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>The data is not prepared for Time Series.</p></li>
<li><p>Determine if the data is non-stationary or stationary.</p></li>
<li><p>Limited Time Series prediction exist, analyzing crime in Detroit.</p></li>
<li><p>No Time Series exist using Auto ARIMA to predict crime in Detroit.</p></li>
</ol>
</div>
<div class="section" id="target-objectives">
<h2>Target Objectives<a class="headerlink" href="#target-objectives" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Aggregate the <code class="docutils literal notranslate"><span class="pre">incident_timestamp</span></code> into monthly crime average.</p></li>
<li><p>Provide a Time Series prediction with Average Monthly crimes in the City of Detroit.</p></li>
<li><p>Build complex AutoRegressive, Auto ARIMA, and SARIMAX models.</p></li>
<li><p>Analyze results from multiple Tiime Series models.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">dateutil.parser</span> <span class="kn">import</span> <span class="n">parse</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;dark_background&quot;</span><span class="p">)</span>
<span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;#7CFC00&quot;</span>
<span class="n">color2</span> <span class="o">=</span> <span class="s2">&quot;#FFE900&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://media.githubusercontent.com/media/kyle-w-brown/detroit-crime-prediction-auto-arima/main/data/RMS_Crime_Incidents.csv&quot;</span><span class="p">)</span>

<span class="c1"># Convert &#39;incident_timestamp&#39; to DateTime</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;incident_timestamp&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">#Filtering from 2017</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2017</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(478043, 26)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="exploring-time">
<h1>Exploring Time<a class="headerlink" href="#exploring-time" title="Permalink to this headline">¶</a></h1>
<p>We will begin by aggregating the <code class="docutils literal notranslate"><span class="pre">time</span></code> column and from there create a montly average of crimes since 2017.</p>
<div class="section" id="daily-crimes">
<h2>Daily Crimes<a class="headerlink" href="#daily-crimes" title="Permalink to this headline">¶</a></h2>
<p>Creating a <code class="docutils literal notranslate"><span class="pre">time</span></code> dataframe with daily crime count.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_crime</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">])[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">df_crime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_crime</span><span class="p">)</span>
<span class="n">df_crime</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;number_of_crimes&#39;</span><span class="p">]</span>
<span class="n">df_crime</span> <span class="o">=</span> <span class="n">df_crime</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">df_crime</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-706e5e94-7712-4c46-97ac-c5d93c12e913">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>number_of_crimes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2017-01-01</td>
      <td>311</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2017-01-02</td>
      <td>239</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017-01-03</td>
      <td>207</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2017-01-04</td>
      <td>218</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2017-01-05</td>
      <td>182</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-706e5e94-7712-4c46-97ac-c5d93c12e913')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-706e5e94-7712-4c46-97ac-c5d93c12e913 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-706e5e94-7712-4c46-97ac-c5d93c12e913');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
</div></div>
</div>
</div>
<div class="section" id="yearly-number-of-crimes">
<h2>Yearly Number of Crimes<a class="headerlink" href="#yearly-number-of-crimes" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">year_crime</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">])[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">year_crime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">year_crime</span><span class="p">)</span>
<span class="n">year_crime</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;number_of_crimes&#39;</span><span class="p">]</span>
<span class="n">year_crime</span> <span class="o">=</span> <span class="n">year_crime</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">year_crime</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-5b814603-a6f7-426b-b041-f3806ea8f0ab">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>number_of_crimes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2017</td>
      <td>81574</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018</td>
      <td>82357</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019</td>
      <td>84213</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020</td>
      <td>77939</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2021</td>
      <td>77725</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-5b814603-a6f7-426b-b041-f3806ea8f0ab')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-5b814603-a6f7-426b-b041-f3806ea8f0ab button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-5b814603-a6f7-426b-b041-f3806ea8f0ab');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
</div></div>
</div>
</div>
<div class="section" id="average-monthly-crimes">
<h2>Average Monthly Crimes<a class="headerlink" href="#average-monthly-crimes" title="Permalink to this headline">¶</a></h2>
<p>Aggregating daily crimes into monthly crime average, <code class="docutils literal notranslate"><span class="pre">avg_crime</span></code> column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">df_crime</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">(</span><span class="n">df_crime</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">))[</span><span class="s1">&#39;number_of_crimes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
<span class="n">ts</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;avg_crimes&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>

<span class="n">ts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-f3bab6df-3083-426c-ad9b-3991dedceff6">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>avg_crimes</th>
    </tr>
    <tr>
      <th>time</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2017-01-01</th>
      <td>201.42</td>
    </tr>
    <tr>
      <th>2017-02-01</th>
      <td>206.07</td>
    </tr>
    <tr>
      <th>2017-03-01</th>
      <td>212.32</td>
    </tr>
    <tr>
      <th>2017-04-01</th>
      <td>227.93</td>
    </tr>
    <tr>
      <th>2017-05-01</th>
      <td>235.97</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-f3bab6df-3083-426c-ad9b-3991dedceff6')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-f3bab6df-3083-426c-ad9b-3991dedceff6 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-f3bab6df-3083-426c-ad9b-3991dedceff6');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
</div></div>
</div>
</div>
<div class="section" id="monthly-average-crime-breakdown">
<h2>Monthly Average Crime Breakdown<a class="headerlink" href="#monthly-average-crime-breakdown" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-f5e06983-1c52-4c71-b814-03a4e8785d6a">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>avg_crimes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>71.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>221.213239</td>
    </tr>
    <tr>
      <th>std</th>
      <td>21.069966</td>
    </tr>
    <tr>
      <th>min</th>
      <td>163.540000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>206.210000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>222.710000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>237.075000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>263.100000</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-f5e06983-1c52-4c71-b814-03a4e8785d6a')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-f5e06983-1c52-4c71-b814-03a4e8785d6a button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-f5e06983-1c52-4c71-b814-03a4e8785d6a');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
</div></div>
</div>
<p>There are 71 months recorded with an average monthly crime rate of 221.</p>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="visualization">
<h1>Visualization<a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h1>
<div class="section" id="time-series-plot">
<h2>Time Series Plot<a class="headerlink" href="#time-series-plot" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Average Crimes by Month in Detroit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average Number of Crimes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_22_0.png" src="_images/intro_22_0.png" />
</div>
</div>
<p>The time series plot appears to have a cyclical pattern in three year intervals with seasonal patterns peaking during the summer months and dipping during winter months.</p>
</div>
<div class="section" id="yearly-bar-plot">
<h2>Yearly Bar Plot<a class="headerlink" href="#yearly-bar-plot" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">year_crime</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">year_crime</span><span class="p">[</span><span class="s1">&#39;number_of_crimes&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Yearly Crimes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Total Number of Crimes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_25_0.png" src="_images/intro_25_0.png" />
</div>
</div>
</div>
<div class="section" id="average-crime-histogram">
<h2>Average Crime Histogram<a class="headerlink" href="#average-crime-histogram" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Average Crimes Histogram&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_27_0.png" src="_images/intro_27_0.png" />
</div>
</div>
</div>
<div class="section" id="lag-plot">
<h2>Lag Plot<a class="headerlink" href="#lag-plot" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandas.plotting</span> <span class="kn">import</span> <span class="n">lag_plot</span>

<span class="n">lag_plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_29_0.png" src="_images/intro_29_0.png" />
</div>
</div>
<p>There appears to be a positive correlation among the lag plot.</p>
</div>
<div class="section" id="correlation">
<h2>Correlation<a class="headerlink" href="#correlation" title="Permalink to this headline">¶</a></h2>
<p>Creating lagged variables at different time steps
to determine if the values of the observation at the current and previous time steps are significant in predicting the future.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extracting only average crime values</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">avg_crimes</span><span class="p">)</span>
 
<span class="c1"># using shift function to shift the values.</span>
<span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">values</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">values</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                       <span class="n">values</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">values</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;t+1&#39;</span><span class="p">,</span> <span class="s1">&#39;t+2&#39;</span><span class="p">,</span> <span class="s1">&#39;t+3&#39;</span><span class="p">]</span>
 
<span class="n">result</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
 
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>            t       t+1       t+2       t+3
t    1.000000  0.769072  0.501006  0.111145
t+1  0.769072  1.000000  0.773342  0.488646
t+2  0.501006  0.773342  1.000000  0.763917
t+3  0.111145  0.488646  0.763917  1.000000
</pre></div>
</div>
</div>
</div>
<p>The values in the observation are significant for predicting the future.</p>
</div>
<div class="section" id="autocorrelation-plot">
<h2>Autocorrelation Plot<a class="headerlink" href="#autocorrelation-plot" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandas.plotting</span> <span class="kn">import</span> <span class="n">autocorrelation_plot</span>

<span class="n">autocorrelation_plot</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;avg_crimes&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lag (months)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_35_0.png" src="_images/intro_35_0.png" />
</div>
</div>
<p>The autocorrelation identifies a clear indication of seasonality among the data.</p>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="time-series-models">
<h1>Time Series Models<a class="headerlink" href="#time-series-models" title="Permalink to this headline">¶</a></h1>
<p>The Time Series models will weigh heavily on Auto ARIMA, Auto-Regression, and SARIMA. The Auto ARIMA model is an automated configuration to the <em><strong>Auto-Regressive Integrated Moving Average (ARIMA)</strong></em> model. Another model that will be a focus which was indicated at a high level of seasonality is the <em><strong>Seasonal Auto-Regressive Integrated Moving Average (SARIMA)</strong></em>.</p>
<br>
<p><em><strong>Auto ARIMA</strong></em> finds the optimal order and the optimal seasonal order, based on determined criterion such as AIC, BIC, etc., and within the designated parameter restrictions, that fits the best model to a single variable (univariable) time series. While the <em><strong>Seasonal ARIMA (SARIMA)</strong></em> variant is a statistical model that can work with non-stationary data and capture some seasonality.</p>
<p><strong>Overview:</strong></p>
<ul class="simple">
<li><p>Stationary Check</p></li>
<li><p>Base SARIMA Model</p></li>
<li><p>Single-Step SARIMA Model</p></li>
<li><p>AutoRegressive Model</p></li>
<li><p>Stepwise Auto ARIMA Model</p></li>
<li><p>Seasonal Decomposed ARIMA Model</p></li>
<li><p>Decomposed SARIMAX Model</p></li>
<li><p>Multi-Step SARIMA Model</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>

<span class="n">dftest</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">avg_crimes</span><span class="p">,</span> <span class="n">autolag</span> <span class="o">=</span> <span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. ADF : &quot;</span><span class="p">,</span><span class="n">dftest</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. P-Value : &quot;</span><span class="p">,</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. Num of Lags : &quot;</span><span class="p">,</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4. Num of Observations used for ADF Regression and Critical Values Calculation :&quot;</span><span class="p">,</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;5. Critical Values :&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;: &quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1. ADF :  -1.3959352749239056
2. P-Value :  0.5842232399888005
3. Num of Lags :  9
4. Num of Observations used for ADF Regression and Critical Values Calculation : 61
5. Critical Values :
	 1% :  -3.542412746661615
	 5% :  -2.910236235808284
	 10% :  -2.5927445767266866
</pre></div>
</div>
</div>
</div>
<p>With the p-value being larger than 0.05, we cannot reject the null hypothesis and the time series is not stationary.</p>
<div class="section" id="training-and-testing-split">
<h2>Training and Testing Split<a class="headerlink" href="#training-and-testing-split" title="Permalink to this headline">¶</a></h2>
<p>Taking the most recent 14 periods as testing and the intial 57 periods as training.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Spliting the dataset into train and test</span>
<span class="n">ts_train</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[:</span><span class="mi">57</span><span class="p">]</span>
<span class="n">ts_test</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">14</span><span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_train</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_42_0.png" src="_images/intro_42_0.png" />
</div>
</div>
</div>
<div class="section" id="stationary-check">
<h2>Stationary Check<a class="headerlink" href="#stationary-check" title="Permalink to this headline">¶</a></h2>
<p>Checking if Time Series is stationary to determine if long-term forecasting is possible.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">check_stationary</span><span class="p">(</span><span class="n">ts</span><span class="p">):</span>
    <span class="n">dftest</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
    <span class="n">adf</span> <span class="o">=</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pvalue</span> <span class="o">=</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">critical_value</span> <span class="o">=</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;5%&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pvalue</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">adf</span> <span class="o">&lt;</span> <span class="n">critical_value</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The series is stationary&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The series is NOT stationary&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">check_stationary</span><span class="p">(</span><span class="n">ts_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The series is NOT stationary
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="stationary-difference">
<h2>Stationary Difference<a class="headerlink" href="#stationary-difference" title="Permalink to this headline">¶</a></h2>
<p>Since the Time Series is not stationary, it gets differenced and checked again for stationarity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_diff</span> <span class="o">=</span> <span class="n">ts_train</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="n">ts_diff</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">check_stationary</span><span class="p">(</span><span class="n">ts_diff</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The series is stationary
</pre></div>
</div>
</div>
</div>
<div class="section" id="difference-to-stationary-plot">
<h3>Difference to Stationary Plot<a class="headerlink" href="#difference-to-stationary-plot" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_diff</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Differenced Time Series&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_51_0.png" src="_images/intro_51_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="autocorrelation-p-d-q-selection">
<h2>Autocorrelation <code class="docutils literal notranslate"><span class="pre">(p,d,q)</span></code> Selection<a class="headerlink" href="#autocorrelation-p-d-q-selection" title="Permalink to this headline">¶</a></h2>
<p>The (P,D,Q,M) Order refers to the seasonal component of the model for the Auto Regressive parameters, differences, Moving Average parameters, and periodicity:</p>
<ul class="simple">
<li><p>(<strong>P</strong>) indicates the Auto Regressive order for the seasonal component.</p></li>
<li><p>(<strong>D</strong>) indicates the integration order of the seasonal process (the number of transformations needed to make stationary the time series).</p></li>
<li><p>(<strong>Q</strong>) indicates the Moving Average order for the seasonal component.</p></li>
<li><p>(<strong>M</strong>) indicates the periodicity, i.e. the number of periods in season, such as 12 for monthly data.</p></li>
</ul>
<p>Since the time series is now stationary, the difference order for the training model is set to 1. (<code class="docutils literal notranslate"><span class="pre">d=1</span></code>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">ts_diff</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_55_0.png" src="_images/intro_55_0.png" />
</div>
</div>
<p>The maximum value of PACF out the confidence intervals is 9. (<code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">=</span> <span class="pre">9</span></code>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="mi">9</span>
</pre></div>
</div>
</div>
</div>
<p>Next, the Autocorrelation (ACF) graph will calculate the value of q.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_acf</span><span class="p">(</span><span class="n">ts_diff</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_59_0.png" src="_images/intro_59_0.png" />
</div>
</div>
<p>Looking at the acf, 6 is the most conservative and best leveraged. (<code class="docutils literal notranslate"><span class="pre">q=6</span></code>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="mi">6</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="base-sarima">
<h2>Base SARIMA<a class="headerlink" href="#base-sarima" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<p>The <strong>Seasonal Auto-Regressive Integrated Moving Average (SARIMA)</strong> model, or <strong>SARIMA(<em>p,d,q</em>)(<em>P,D,Q</em>)<span class="math notranslate nohighlight">\(_{m}\)</span></strong>, adds another set of parameters that takes into account periodic patterns when forecasting a time series, which is not always possible with an <strong>ARIMA(<em>p,d,q</em>)</strong> model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.statespace.sarimax</span> <span class="kn">import</span> <span class="n">SARIMAX</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">SARIMAX</span><span class="p">(</span><span class="n">ts_train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">q</span><span class="p">))</span>
<span class="n">base_sarima_model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">base_sarima_model_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>SARIMAX Results</caption>
<tr>
  <th>Dep. Variable:</th>      <td>avg_crimes</td>    <th>  No. Observations:  </th>    <td>57</td>   
</tr>
<tr>
  <th>Model:</th>           <td>SARIMAX(9, 1, 6)</td> <th>  Log Likelihood     </th> <td>-204.780</td>
</tr>
<tr>
  <th>Date:</th>            <td>Sat, 10 Dec 2022</td> <th>  AIC                </th>  <td>441.559</td>
</tr>
<tr>
  <th>Time:</th>                <td>05:09:37</td>     <th>  BIC                </th>  <td>473.965</td>
</tr>
<tr>
  <th>Sample:</th>             <td>01-01-2017</td>    <th>  HQIC               </th>  <td>454.123</td>
</tr>
<tr>
  <th></th>                   <td>- 09-01-2021</td>   <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>        <td>opg</td>       <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
     <td></td>       <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>ar.L1</th>  <td>   -0.6784</td> <td>    0.424</td> <td>   -1.600</td> <td> 0.110</td> <td>   -1.509</td> <td>    0.153</td>
</tr>
<tr>
  <th>ar.L2</th>  <td>   -0.2933</td> <td>    0.402</td> <td>   -0.730</td> <td> 0.465</td> <td>   -1.080</td> <td>    0.494</td>
</tr>
<tr>
  <th>ar.L3</th>  <td>    0.0143</td> <td>    0.510</td> <td>    0.028</td> <td> 0.978</td> <td>   -0.985</td> <td>    1.013</td>
</tr>
<tr>
  <th>ar.L4</th>  <td>   -0.0773</td> <td>    0.349</td> <td>   -0.221</td> <td> 0.825</td> <td>   -0.762</td> <td>    0.607</td>
</tr>
<tr>
  <th>ar.L5</th>  <td>   -0.3631</td> <td>    0.344</td> <td>   -1.056</td> <td> 0.291</td> <td>   -1.037</td> <td>    0.311</td>
</tr>
<tr>
  <th>ar.L6</th>  <td>   -0.8369</td> <td>    0.335</td> <td>   -2.501</td> <td> 0.012</td> <td>   -1.493</td> <td>   -0.181</td>
</tr>
<tr>
  <th>ar.L7</th>  <td>   -0.3752</td> <td>    0.286</td> <td>   -1.312</td> <td> 0.189</td> <td>   -0.936</td> <td>    0.185</td>
</tr>
<tr>
  <th>ar.L8</th>  <td>   -0.3143</td> <td>    0.233</td> <td>   -1.350</td> <td> 0.177</td> <td>   -0.771</td> <td>    0.142</td>
</tr>
<tr>
  <th>ar.L9</th>  <td>   -0.4757</td> <td>    0.205</td> <td>   -2.318</td> <td> 0.020</td> <td>   -0.878</td> <td>   -0.073</td>
</tr>
<tr>
  <th>ma.L1</th>  <td>    0.4039</td> <td>    0.754</td> <td>    0.536</td> <td> 0.592</td> <td>   -1.073</td> <td>    1.881</td>
</tr>
<tr>
  <th>ma.L2</th>  <td>   -0.0616</td> <td>    1.760</td> <td>   -0.035</td> <td> 0.972</td> <td>   -3.511</td> <td>    3.388</td>
</tr>
<tr>
  <th>ma.L3</th>  <td>   -0.4458</td> <td>    0.627</td> <td>   -0.711</td> <td> 0.477</td> <td>   -1.674</td> <td>    0.782</td>
</tr>
<tr>
  <th>ma.L4</th>  <td>   -0.0698</td> <td>    1.656</td> <td>   -0.042</td> <td> 0.966</td> <td>   -3.315</td> <td>    3.176</td>
</tr>
<tr>
  <th>ma.L5</th>  <td>    0.4061</td> <td>    1.000</td> <td>    0.406</td> <td> 0.685</td> <td>   -1.554</td> <td>    2.366</td>
</tr>
<tr>
  <th>ma.L6</th>  <td>    0.8988</td> <td>    1.440</td> <td>    0.624</td> <td> 0.533</td> <td>   -1.924</td> <td>    3.721</td>
</tr>
<tr>
  <th>sigma2</th> <td>   71.1447</td> <td>   88.095</td> <td>    0.808</td> <td> 0.419</td> <td> -101.519</td> <td>  243.808</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Ljung-Box (L1) (Q):</th>     <td>0.20</td> <th>  Jarque-Bera (JB):  </th> <td>6.26</td> 
</tr>
<tr>
  <th>Prob(Q):</th>                <td>0.66</td> <th>  Prob(JB):          </th> <td>0.04</td> 
</tr>
<tr>
  <th>Heteroskedasticity (H):</th> <td>2.71</td> <th>  Skew:              </th> <td>-0.59</td>
</tr>
<tr>
  <th>Prob(H) (two-sided):</th>    <td>0.04</td> <th>  Kurtosis:          </th> <td>4.13</td> 
</tr>
</table><br/><br/>Warnings:<br/>[1] Covariance matrix calculated using the outer product of gradients (complex-step).</div></div>
</div>
<p>According to the model summary, the model meets the condition of independence in the residuals (no correlation) because the p-value of the Ljung-Box test (<code class="docutils literal notranslate"><span class="pre">Prob(Q):</span> <span class="pre">0.66</span></code>) is greater than 0.05, so we cannot reject the null hypothesis of independence, but we cannot say that the residual distribution is homoscedastic (constant variance) because the p-value of the Heteroskedasticity test (<code class="docutils literal notranslate"><span class="pre">Prob(H):</span> <span class="pre">0.04</span></code>) is smaller than 0.05.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">normaltest</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="n">resid</span> <span class="o">=</span> <span class="n">base_sarima_model_fit</span><span class="o">.</span><span class="n">resid</span>
<span class="nb">print</span><span class="p">(</span><span class="n">normaltest</span><span class="p">(</span><span class="n">resid</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax0</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">resid</span> <span class="p">,</span><span class="n">fit</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span> 

<span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Normal dist. ($\mu=$ </span><span class="si">{:.2f}</span><span class="s1"> and $\sigma=$ </span><span class="si">{:.2f}</span><span class="s1"> )&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual distribution&#39;</span><span class="p">)</span>


<span class="c1"># ACF and PACF</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">9.27</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">plot_acf</span><span class="p">(</span><span class="n">base_sarima_model_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">plot_pacf</span><span class="p">(</span><span class="n">base_sarima_model_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NormaltestResult(statistic=113.60945887433616, pvalue=2.1380578873051365e-25)
</pre></div>
</div>
<img alt="_images/intro_65_1.png" src="_images/intro_65_1.png" />
<img alt="_images/intro_65_2.png" src="_images/intro_65_2.png" />
</div>
</div>
<p>The graph does pass the eye test for a normal distribution. With the mean of 3.45 and standard deviation of 27.86 the model is not distributed normally. There is also no correlation among the PACF.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_test</span> <span class="o">=</span> <span class="n">ts_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">base_sarima_pred</span> <span class="o">=</span> <span class="n">base_sarima_model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">n_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="base-sarimax-prediction">
<h3>Base SARIMAX Prediction<a class="headerlink" href="#base-sarimax-prediction" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">SMAPE</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">forecast</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span><span class="o">-</span><span class="n">actual</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.eval_measures</span> <span class="kn">import</span> <span class="n">rmse</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">base_sarima_pred_score</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">base_sarima_pred</span><span class="p">)</span>
<span class="n">nrmse</span> <span class="o">=</span> <span class="n">rmse</span><span class="p">(</span><span class="n">base_sarima_pred_score</span><span class="p">,</span> <span class="n">ts_test</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ts_test</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ts_test</span><span class="p">))</span>
<span class="n">smape</span> <span class="o">=</span> <span class="n">SMAPE</span><span class="p">(</span><span class="n">ts_test</span><span class="o">.</span><span class="n">avg_crimes</span><span class="p">,</span> <span class="n">base_sarima_pred</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MSE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">base_sarima_pred_score</span><span class="p">),</span> <span class="mi">3</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Normalized RMSE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nrmse</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R^2: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">base_sarima_pred_score</span><span class="p">),</span> <span class="mi">6</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SMAPE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span> <span class="nb">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">smape</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MSE: 202.843
Normalized RMSE: 0.202248
R^2: 0.570539
SMAPE: 0.057084
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="base-sarima-prediction-plot">
<h3>Base SARIMA Prediction Plot<a class="headerlink" href="#base-sarima-prediction-plot" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">base_sarima_pred_score</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Base SARIMA Prediction Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average Number of Crimes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_72_0.png" src="_images/intro_72_0.png" />
</div>
</div>
</div>
<div class="section" id="base-sarima-forecast">
<h3>Base SARIMA Forecast<a class="headerlink" href="#base-sarima-forecast" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The forecast will be 200 periods (months) out</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">base_sarima_forecast</span> <span class="o">=</span> <span class="n">base_sarima_model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">n_test</span><span class="o">+</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">base_sarima_forecast</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Base SARIMA Forecast&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average Number of Crimes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_75_0.png" src="_images/intro_75_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="single-step-sarima">
<h2>Single-Step SARIMA<a class="headerlink" href="#single-step-sarima" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<p>Implementing a single-step to fit the forecast following the (<em>p,d,q</em>) order, to iterate through the series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_train_step</span> <span class="o">=</span> <span class="n">ts_train</span>
<span class="n">ts_pred_step</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_test</span><span class="p">):</span>
    <span class="n">model_step</span> <span class="o">=</span> <span class="n">SARIMAX</span><span class="p">(</span><span class="n">ts_train_step</span><span class="o">.</span><span class="n">avg_crimes</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">q</span><span class="p">))</span>
    <span class="n">model_step_fit</span> <span class="o">=</span> <span class="n">model_step</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">current_pred</span> <span class="o">=</span> <span class="n">model_step_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ts_train_step</span> <span class="o">=</span> <span class="n">ts_train_step</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_pred</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ts_pred_step</span> <span class="o">=</span> <span class="n">ts_pred_step</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_step_fit</span><span class="o">.</span><span class="n">plot_diagnostics</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_78_0.png" src="_images/intro_78_0.png" />
</div>
</div>
<p>The standardized residual plot depicts variance change around a mean of zero with uniform variance. While the normal Q-Q plot demonstrates that the residuals do not follow a normal distribution with slight normality and skewed tails.The Correlogram does not show any significant correlation in the residuals. Any autocorrelation would imply that there is some pattern in the residual errors which are not explained in the model.</p>
<div class="section" id="single-step-sarima-prediction">
<h3>Single-Step SARIMA Prediction<a class="headerlink" href="#single-step-sarima-prediction" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_pred_step_score</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ts_pred_step</span><span class="p">)</span>
<span class="n">nrmse</span> <span class="o">=</span> <span class="n">rmse</span><span class="p">(</span><span class="n">ts_pred_step_score</span><span class="p">,</span> <span class="n">ts_test</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ts_test</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ts_test</span><span class="p">))</span>
<span class="n">smape</span> <span class="o">=</span> <span class="n">SMAPE</span><span class="p">(</span><span class="n">ts_test</span><span class="o">.</span><span class="n">avg_crimes</span><span class="p">,</span> <span class="n">ts_pred_step</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MSE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">ts_pred_step</span><span class="p">),</span> <span class="mi">3</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Normalized RMSE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nrmse</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R^2: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">ts_pred_step</span><span class="p">),</span> <span class="mi">6</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SMAPE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span> <span class="nb">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">smape</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MSE: 198.395
Normalized RMSE: 0.200018
R^2: 0.579956
SMAPE: 0.00101
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="single-step-sarima-prediction-plot">
<h3>Single-Step SARIMA Prediction Plot<a class="headerlink" href="#single-step-sarima-prediction-plot" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Creating Time Series Prediction Step scoring frame into DataFrame</span>
<span class="n">tsps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ts_pred_step</span><span class="p">)</span>
<span class="n">tsps</span> <span class="o">=</span> <span class="n">tsps</span><span class="o">.</span><span class="n">values</span>
<span class="n">tsps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tsps</span><span class="p">)</span>

<span class="n">ts_date</span> <span class="o">=</span> <span class="n">base_sarima_pred</span><span class="o">.</span><span class="n">index</span>
<span class="n">ts_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ts_date</span><span class="p">)</span>

<span class="n">ts_pred_step_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ts_date</span><span class="p">,</span> <span class="n">tsps</span><span class="p">],</span> <span class="n">join</span> <span class="o">=</span> <span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ts_pred_step_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;avg_crimes&#39;</span><span class="p">]</span>
<span class="n">ts_pred_step_df</span> <span class="o">=</span> <span class="n">ts_pred_step_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">ts_pred_step_df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]))</span>
<span class="n">ts_pred_step_df</span> <span class="o">=</span> <span class="n">ts_pred_step_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_pred_step_df</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Single-Step SARIMA Prediction Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average Number of Crimes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_84_0.png" src="_images/intro_84_0.png" />
</div>
</div>
</div>
<div class="section" id="single-step-sarima-forecast">
<h3>Single-Step SARIMA Forecast<a class="headerlink" href="#single-step-sarima-forecast" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_pred_forecast</span> <span class="o">=</span> <span class="n">model_step_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">n_test</span><span class="o">+</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create scoring dataframe</span>

<span class="n">tsps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ts_pred_forecast</span><span class="p">)</span>
<span class="n">tsps</span> <span class="o">=</span> <span class="n">tsps</span><span class="o">.</span><span class="n">values</span>
<span class="n">tsps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tsps</span><span class="p">)</span>

<span class="n">ts_date</span> <span class="o">=</span> <span class="n">base_sarima_forecast</span><span class="o">.</span><span class="n">index</span>
<span class="n">ts_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ts_date</span><span class="p">)</span>

<span class="n">single_step_forecast</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ts_date</span><span class="p">,</span> <span class="n">tsps</span><span class="p">],</span> <span class="n">join</span> <span class="o">=</span> <span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">single_step_forecast</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;avg_crimes&#39;</span><span class="p">]</span>
<span class="n">single_step_forecast</span> <span class="o">=</span> <span class="n">single_step_forecast</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">single_step_forecast</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]))</span>
<span class="n">single_step_forecast</span> <span class="o">=</span> <span class="n">single_step_forecast</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">single_step_forecast</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Single-Step SARIMA Forecast&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average Number of Crimes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_88_0.png" src="_images/intro_88_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="autoregressive">
<h2>AutoRegressive<a class="headerlink" href="#autoregressive" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<p>Autoregression modeling is a modeling technique used for time series data that assumes linear continuation of the series so that previous values in the time series can be used to predict futures values. The previous time step(s) is useful in predicting the value at the next time step (dependance between values).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.ar_model</span> <span class="kn">import</span> <span class="n">AutoReg</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">AutoReg</span><span class="p">(</span><span class="n">ts_train</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ar_model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ar_model_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            AutoReg Model Results                             
==============================================================================
Dep. Variable:             avg_crimes   No. Observations:                   57
Model:                    AutoReg(12)   Log Likelihood                -168.969
Method:               Conditional MLE   S.D. of innovations             10.339
Date:                Sat, 10 Dec 2022   AIC                            365.937
Time:                        05:11:30   BIC                            391.230
Sample:                    01-01-2018   HQIC                           375.366
                         - 09-01-2021                                         
==================================================================================
                     coef    std err          z      P&gt;|z|      [0.025      0.975]
----------------------------------------------------------------------------------
const             35.3943     48.996      0.722      0.470     -60.637     131.425
avg_crimes.L1      0.6856      0.146      4.686      0.000       0.399       0.972
avg_crimes.L2      0.1049      0.176      0.595      0.552      -0.240       0.450
avg_crimes.L3     -0.1553      0.166     -0.935      0.350      -0.481       0.170
avg_crimes.L4     -0.0190      0.169     -0.112      0.910      -0.349       0.311
avg_crimes.L5      0.0692      0.168      0.411      0.681      -0.261       0.399
avg_crimes.L6     -0.1647      0.170     -0.966      0.334      -0.499       0.169
avg_crimes.L7     -0.0017      0.174     -0.010      0.992      -0.342       0.339
avg_crimes.L8      0.0185      0.195      0.095      0.925      -0.364       0.401
avg_crimes.L9     -0.1677      0.195     -0.859      0.391      -0.550       0.215
avg_crimes.L10     0.5636      0.198      2.848      0.004       0.176       0.952
avg_crimes.L11    -0.2052      0.217     -0.944      0.345      -0.631       0.221
avg_crimes.L12     0.1080      0.173      0.623      0.533      -0.232       0.448
                                    Roots                                     
==============================================================================
                   Real          Imaginary           Modulus         Frequency
------------------------------------------------------------------------------
AR.1            -1.0502           -0.0000j            1.0502           -0.5000
AR.2            -0.8446           -0.6012j            1.0367           -0.4015
AR.3            -0.8446           +0.6012j            1.0367            0.4015
AR.4             1.0443           -0.0000j            1.0443           -0.0000
AR.5             0.8826           -0.5010j            1.0149           -0.0822
AR.6             0.8826           +0.5010j            1.0149            0.0822
AR.7            -0.3154           -1.0950j            1.1396           -0.2946
AR.8            -0.3154           +1.0950j            1.1396            0.2946
AR.9             0.4257           -1.0338j            1.1180           -0.1878
AR.10            0.4257           +1.0338j            1.1180            0.1878
AR.11            0.8044           -2.0123j            2.1671           -0.1895
AR.12            0.8044           +2.0123j            2.1671            0.1895
------------------------------------------------------------------------------
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">normaltest</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="n">resid</span> <span class="o">=</span> <span class="n">ar_model_fit</span><span class="o">.</span><span class="n">resid</span>
<span class="nb">print</span><span class="p">(</span><span class="n">normaltest</span><span class="p">(</span><span class="n">resid</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax0</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">resid</span> <span class="p">,</span><span class="n">fit</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span> 

<span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Normal dist. ($\mu=$ </span><span class="si">{:.2f}</span><span class="s1"> and $\sigma=$ </span><span class="si">{:.2f}</span><span class="s1"> )&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual distribution&#39;</span><span class="p">)</span>


<span class="c1"># ACF and PACF</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">9.38</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">plot_acf</span><span class="p">(</span><span class="n">ar_model_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">plot_pacf</span><span class="p">(</span><span class="n">ar_model_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NormaltestResult(statistic=0.2144493623686411, pvalue=0.8983238138557795)
</pre></div>
</div>
<img alt="_images/intro_91_1.png" src="_images/intro_91_1.png" />
<img alt="_images/intro_91_2.png" src="_images/intro_91_2.png" />
</div>
</div>
<p>The p-value is higher than 0.05, meaning the residual is a normal distribution. The distribuiton plot also confirms this. The Autocorrelation shows that the Time Series residuals have low correlation with lagged versions of itself.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_test</span> <span class="o">=</span> <span class="n">ts_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ar_pred</span> <span class="o">=</span> <span class="n">ar_model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">n_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="autoregressive-prediction">
<h3>AutoRegressive Prediction<a class="headerlink" href="#autoregressive-prediction" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ar_pred_score</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ar_pred</span><span class="p">)</span>
<span class="n">nrmse</span> <span class="o">=</span> <span class="n">rmse</span><span class="p">(</span><span class="n">ar_pred_score</span><span class="p">,</span> <span class="n">ts_test</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ts_test</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ts_test</span><span class="p">))</span>
<span class="n">smape</span> <span class="o">=</span> <span class="n">SMAPE</span><span class="p">(</span><span class="n">ts_test</span><span class="o">.</span><span class="n">avg_crimes</span><span class="p">,</span> <span class="n">ar_pred</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MSE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">ar_pred_score</span><span class="p">),</span> <span class="mi">3</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Normalized RMSE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nrmse</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R^2: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">ar_pred_score</span><span class="p">),</span> <span class="mi">6</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SMAPE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span> <span class="nb">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">smape</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MSE: 184.115
Normalized RMSE: 0.192685
R^2: 0.61019
SMAPE: 0.051873
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="autoregressive-prediction-plot">
<h3>AutoRegressive Prediction Plot<a class="headerlink" href="#autoregressive-prediction-plot" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ar_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;AutoRegressive Model Forecast&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average Number of Crimes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_97_0.png" src="_images/intro_97_0.png" />
</div>
</div>
</div>
<div class="section" id="autoregressive-forecast">
<h3>AutoRegressive Forecast<a class="headerlink" href="#autoregressive-forecast" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ar_forecast</span> <span class="o">=</span> <span class="n">ar_model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">n_test</span><span class="o">+</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ar_forecast</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;AutoRegressive Model Forecast&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average Number of Crimes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_100_0.png" src="_images/intro_100_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="stepwise-auto-arima">
<h2>Stepwise Auto ARIMA<a class="headerlink" href="#stepwise-auto-arima" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pmdarima</span> <span class="k">as</span> <span class="nn">pm</span>

<span class="n">stepwise_model</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">auto_arima</span><span class="p">(</span><span class="n">ts_train</span><span class="p">,</span> 
                               <span class="n">start_p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                               <span class="n">max_p</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">max_q</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> 
                               <span class="n">m</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                               <span class="n">seasonal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                               <span class="n">stationary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">information_criterion</span><span class="o">=</span><span class="s1">&#39;aic&#39;</span><span class="p">,</span>
                               <span class="n">stepwise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                               <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">stepwise_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">ts_train</span><span class="p">)</span>
<span class="n">stepwise_model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>SARIMAX Results</caption>
<tr>
  <th>Dep. Variable:</th>                   <td>y</td>                <th>  No. Observations:  </th>    <td>57</td>   
</tr>
<tr>
  <th>Model:</th>           <td>SARIMAX(0, 1, 0)x(1, 0, [1], 12)</td> <th>  Log Likelihood     </th> <td>-222.662</td>
</tr>
<tr>
  <th>Date:</th>                    <td>Sat, 10 Dec 2022</td>         <th>  AIC                </th>  <td>453.325</td>
</tr>
<tr>
  <th>Time:</th>                        <td>05:14:06</td>             <th>  BIC                </th>  <td>461.426</td>
</tr>
<tr>
  <th>Sample:</th>                     <td>01-01-2017</td>            <th>  HQIC               </th>  <td>456.466</td>
</tr>
<tr>
  <th></th>                           <td>- 09-01-2021</td>           <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>                <td>opg</td>               <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
      <td></td>         <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>intercept</th> <td>    0.0006</td> <td>    0.152</td> <td>    0.004</td> <td> 0.997</td> <td>   -0.298</td> <td>    0.299</td>
</tr>
<tr>
  <th>ar.S.L12</th>  <td>    0.9581</td> <td>    0.255</td> <td>    3.764</td> <td> 0.000</td> <td>    0.459</td> <td>    1.457</td>
</tr>
<tr>
  <th>ma.S.L12</th>  <td>   -0.7831</td> <td>    0.684</td> <td>   -1.145</td> <td> 0.252</td> <td>   -2.124</td> <td>    0.558</td>
</tr>
<tr>
  <th>sigma2</th>    <td>  145.5886</td> <td>   52.981</td> <td>    2.748</td> <td> 0.006</td> <td>   41.748</td> <td>  249.429</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Ljung-Box (L1) (Q):</th>     <td>1.12</td> <th>  Jarque-Bera (JB):  </th> <td>2.26</td> 
</tr>
<tr>
  <th>Prob(Q):</th>                <td>0.29</td> <th>  Prob(JB):          </th> <td>0.32</td> 
</tr>
<tr>
  <th>Heteroskedasticity (H):</th> <td>3.05</td> <th>  Skew:              </th> <td>-0.11</td>
</tr>
<tr>
  <th>Prob(H) (two-sided):</th>    <td>0.02</td> <th>  Kurtosis:          </th> <td>3.96</td> 
</tr>
</table><br/><br/>Warnings:<br/>[1] Covariance matrix calculated using the outer product of gradients (complex-step).</div></div>
</div>
<p>Same situation with this model summary, the model meets the condition of independence in the residuals because the p-value of the Ljung-Box test (<code class="docutils literal notranslate"><span class="pre">Prob(Q):</span> <span class="pre">0.29</span></code>) is greater than 0.05, so we cannot reject the null hypothesis of independence, but we cannot say that the residual distribution is homoscedastic because the p-value of the Heteroskedasticity test (<code class="docutils literal notranslate"><span class="pre">Prob(H):</span> <span class="pre">0.02</span></code>) is smaller than 0.05.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stepwise_model</span><span class="o">.</span><span class="n">plot_diagnostics</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_104_0.png" src="_images/intro_104_0.png" />
</div>
</div>
<p>The standardized residual plot depicts variance change around a mean of zero with uniform variance. The Correlogram does not show any significant correlation in the residuals again. The standardized residual plot depicts variance change again as well, while the normal Q-Q plot demonstrates that the residuals do not follow a normal distribution with skewe tails.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_pred_auto</span> <span class="o">=</span> <span class="n">stepwise_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">n_periods</span><span class="o">=</span><span class="n">n_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="stepwise-auto-arima-prediction">
<h3>Stepwise Auto ARIMA Prediction<a class="headerlink" href="#stepwise-auto-arima-prediction" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_pred_auto_score</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ts_pred_auto</span><span class="p">)</span>
<span class="n">nrmse</span> <span class="o">=</span> <span class="n">rmse</span><span class="p">(</span><span class="n">ts_pred_auto_score</span><span class="p">,</span> <span class="n">ts_test</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ts_test</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ts_test</span><span class="p">))</span>
<span class="n">smape</span> <span class="o">=</span> <span class="n">SMAPE</span><span class="p">(</span><span class="n">ts_test</span><span class="o">.</span><span class="n">avg_crimes</span><span class="p">,</span> <span class="n">ts_pred_auto</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MSE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">ts_pred_auto</span><span class="p">),</span> <span class="mi">3</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nrmse</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R^2: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">ts_pred_auto</span><span class="p">),</span> <span class="mi">6</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SMAPE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span> <span class="nb">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">smape</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MSE: 139.009
RMSE: 0.167427
R^2: 0.705689
SMAPE: 0.040223
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="stepwise-auto-arima-prediction-plot">
<h3>Stepwise Auto ARIMA Prediction Plot<a class="headerlink" href="#stepwise-auto-arima-prediction-plot" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">ts_pred_auto</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Stepwise Auto ARIMA Prediction Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average Number of Crimes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_110_0.png" src="_images/intro_110_0.png" />
</div>
</div>
</div>
<div class="section" id="stepwise-auto-arima-forecast">
<h3>Stepwise Auto ARIMA Forecast<a class="headerlink" href="#stepwise-auto-arima-forecast" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stepwise_forecast</span> <span class="o">=</span> <span class="n">stepwise_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">n_periods</span><span class="o">=</span><span class="n">n_test</span><span class="o">+</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stepwise_forecast</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Stepwise Auto ARIMA Forecast&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average Number of Crimes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_113_0.png" src="_images/intro_113_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="seasonal-decomposition-analysis">
<h2>Seasonal Decomposition Analysis<a class="headerlink" href="#seasonal-decomposition-analysis" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.seasonal</span> <span class="kn">import</span> <span class="n">seasonal_decompose</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ts_decomposed</span> <span class="o">=</span> <span class="n">seasonal_decompose</span><span class="p">(</span><span class="n">ts_train</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;multiplicative&#39;</span><span class="p">,</span> <span class="n">extrapolate_trend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ts_trend</span> <span class="o">=</span> <span class="n">ts_decomposed</span><span class="o">.</span><span class="n">trend</span>
<span class="n">ts_seasonal</span> <span class="o">=</span> <span class="n">ts_decomposed</span><span class="o">.</span><span class="n">seasonal</span>
<span class="n">ts_residual</span> <span class="o">=</span> <span class="n">ts_decomposed</span><span class="o">.</span><span class="n">resid</span>

<span class="n">ts_decomposed</span><span class="o">.</span><span class="n">observed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Observed&#39;</span><span class="p">);</span>
<span class="n">ts_decomposed</span><span class="o">.</span><span class="n">trend</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Trend&#39;</span><span class="p">);</span>
<span class="n">ts_decomposed</span><span class="o">.</span><span class="n">seasonal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Seasonal&#39;</span><span class="p">);</span>
<span class="n">ts_decomposed</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residual&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_115_0.png" src="_images/intro_115_0.png" />
</div>
</div>
<p>Here we can see that the range of trend and residual is marginal. The trend has a variation between 210 to 230, and most of the time residual is having the variation around 1.0. We can observe the seasonality varies between 0.9 to 1.1, which is a very low difference range.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">seasonality</span><span class="o">=</span><span class="n">ts_decomposed</span><span class="o">.</span><span class="n">trend</span>
<span class="n">seasonality</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_117_0.png" src="_images/intro_117_0.png" />
</div>
</div>
<div class="section" id="trend-stationary-check">
<h3>Trend Stationary Check<a class="headerlink" href="#trend-stationary-check" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">check_stationary</span><span class="p">(</span><span class="n">ts_trend</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The series is NOT stationary
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_trend_diff</span> <span class="o">=</span> <span class="n">ts_trend</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="n">ts_trend_diff</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">check_stationary</span><span class="p">(</span><span class="n">ts_trend_diff</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The series is stationary
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="decomposed-auto-arima">
<h2>Decomposed Auto ARIMA<a class="headerlink" href="#decomposed-auto-arima" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stepwise_decompose_model</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">auto_arima</span><span class="p">(</span><span class="n">ts_trend</span><span class="p">,</span>
                                         <span class="n">start_p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">start_q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                         <span class="n">max_p</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">max_q</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> 
                                         <span class="n">m</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                                         <span class="n">seasonal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                         <span class="n">stationary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">information_criterion</span><span class="o">=</span><span class="s1">&#39;aic&#39;</span><span class="p">,</span>
                                         <span class="n">stepwise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                         <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">stepwise_decompose_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">ts_trend</span><span class="p">)</span>
<span class="n">trend_pred_auto</span> <span class="o">=</span> <span class="n">stepwise_decompose_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">n_periods</span><span class="o">=</span><span class="n">n_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stepwise_decompose_model</span><span class="o">.</span><span class="n">plot_diagnostics</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_124_0.png" src="_images/intro_124_0.png" />
</div>
</div>
<p>The residual errors fluctuate around a mean of zero and have a uniform variance. The since the residuals don’t line up on the qq plot, it indicates that the distribution has a skewed tail. The Correlogram, shows the residual errors are not autocorrelated.</p>
<div class="section" id="seasonal-stationary-check">
<h3>Seasonal Stationary Check<a class="headerlink" href="#seasonal-stationary-check" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">check_stationary</span><span class="p">(</span><span class="n">ts_seasonal</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The series is stationary
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stepwise_seasonal_auto_model</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">auto_arima</span><span class="p">(</span><span class="n">ts_seasonal</span><span class="p">,</span> 
                               <span class="n">start_p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">start_q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                               <span class="n">max_p</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">max_q</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> 
                               <span class="n">m</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                               <span class="n">seasonal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                               <span class="n">stationary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">information_criterion</span><span class="o">=</span><span class="s1">&#39;aic&#39;</span><span class="p">,</span>
                               <span class="n">stepwise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">stepwise_seasonal_auto_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">ts_seasonal</span><span class="p">)</span>
<span class="n">seasonal_pred_auto</span> <span class="o">=</span> <span class="n">stepwise_seasonal_auto_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">n_periods</span><span class="o">=</span><span class="n">n_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stepwise_seasonal_auto_model</span><span class="o">.</span><span class="n">plot_diagnostics</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_130_0.png" src="_images/intro_130_0.png" />
</div>
</div>
<p>The residuals over time are shown and imply the residuals have seasonality.The qq-plot does not follow the linear trend of the samples taken from a standard normal distribution with N(0, 1). This is a strong indication that the residuals are not normally distributed. The Correlogram, shows the residual errors are not autocorrelated.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_pred_decompose</span> <span class="o">=</span> <span class="n">trend_pred_auto</span> <span class="o">*</span> <span class="n">seasonal_pred_auto</span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="decomposed-auto-arima-prediction">
<h3>Decomposed Auto ARIMA Prediction<a class="headerlink" href="#decomposed-auto-arima-prediction" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_pred_decompose_score</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ts_pred_decompose</span><span class="p">)</span>
<span class="n">nrmse</span> <span class="o">=</span> <span class="n">rmse</span><span class="p">(</span><span class="n">ts_pred_decompose_score</span><span class="p">,</span> <span class="n">ts_test</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ts_test</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ts_test</span><span class="p">))</span>
<span class="n">smape</span> <span class="o">=</span> <span class="n">SMAPE</span><span class="p">(</span><span class="n">ts_test</span><span class="o">.</span><span class="n">avg_crimes</span><span class="p">,</span> <span class="n">ts_pred_decompose</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MSE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">ts_pred_decompose</span><span class="p">),</span> <span class="mi">3</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nrmse</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R^2: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">ts_pred_decompose</span><span class="p">),</span> <span class="mi">6</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SMAPE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span> <span class="nb">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">smape</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MSE: 156.483
RMSE: 0.177639
R^2: 0.668692
SMAPE: 0.045718
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="decomposed-auto-arima-prediction-plot">
<h3>Decomposed Auto ARIMA Prediction Plot<a class="headerlink" href="#decomposed-auto-arima-prediction-plot" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">ts_pred_decompose</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Auto ARIMA Prediction Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average Number of Crimes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_136_0.png" src="_images/intro_136_0.png" />
</div>
</div>
</div>
<div class="section" id="decomposed-auto-arima-forecast">
<h3>Decomposed Auto ARIMA Forecast<a class="headerlink" href="#decomposed-auto-arima-forecast" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_season_pred</span> <span class="o">=</span> <span class="n">stepwise_seasonal_auto_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">ts_seasonal</span><span class="p">)</span>
<span class="n">seasonal_forecast</span> <span class="o">=</span> <span class="n">ts_season_pred</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">n_periods</span><span class="o">=</span><span class="n">n_test</span><span class="o">+</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">seasonal_forecast</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Auto ARIMA Forecast&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average Number of Crimes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_139_0.png" src="_images/intro_139_0.png" />
</div>
</div>
<p>The seasonal decomposed effect from Auto ARIMA proves to reflect a decent impact to long-term forecasting of seasonality.</p>
</div>
<div class="section" id="seasonal-decomposition-additive-analysis">
<h3>Seasonal Decomposition Additive Analysis<a class="headerlink" href="#seasonal-decomposition-additive-analysis" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.seasonal</span> <span class="kn">import</span> <span class="n">seasonal_decompose</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">seasonal_decompose</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;additive&#39;</span><span class="p">,</span> <span class="n">extrapolate_trend</span><span class="o">=</span><span class="s1">&#39;freq&#39;</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">observed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Observed&#39;</span><span class="p">);</span>
<span class="n">result</span><span class="o">.</span><span class="n">trend</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Trend&#39;</span><span class="p">);</span>
<span class="n">result</span><span class="o">.</span><span class="n">seasonal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Seasonal&#39;</span><span class="p">);</span>
<span class="n">result</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residual&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_142_0.png" src="_images/intro_142_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">seasonality</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">seasonal</span>
<span class="n">seasonality</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_143_0.png" src="_images/intro_143_0.png" />
</div>
</div>
<p>We can see clearly there is seasonality among the decomposition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">seasonal</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">seasonal</span>
<span class="n">check_stationary</span><span class="p">(</span><span class="n">seasonal</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The series is stationary
</pre></div>
</div>
</div>
</div>
<p>Here the series is already stationary. No need to difference the seasonal order. (<code class="docutils literal notranslate"><span class="pre">D</span> <span class="pre">=</span> <span class="pre">0</span></code>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">seasonal</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_148_0.png" src="_images/intro_148_0.png" />
</div>
</div>
<p>In the PACF graph the maximum value out the confidence intervals (in light blue) is 12, thus we can set (<code class="docutils literal notranslate"><span class="pre">P</span> <span class="pre">=</span> <span class="pre">12</span></code>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="mi">12</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_acf</span><span class="p">(</span><span class="n">seasonal</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_151_0.png" src="_images/intro_151_0.png" />
</div>
</div>
<p>From the above graph, we note that the maximum value out the confidence intervals is 8. (<code class="docutils literal notranslate"><span class="pre">Q</span> <span class="pre">=</span> <span class="pre">8</span></code>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Q</span> <span class="o">=</span> <span class="mi">8</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="decomposed-sarima">
<h2>Decomposed SARIMA<a class="headerlink" href="#decomposed-sarima" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.statespace.sarimax</span> <span class="kn">import</span> <span class="n">SARIMAX</span>

<span class="n">seasonal_model</span> <span class="o">=</span> <span class="n">SARIMAX</span><span class="p">(</span><span class="n">ts_train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">q</span><span class="p">))</span>
<span class="n">seasonal_model_fit</span> <span class="o">=</span> <span class="n">seasonal_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">seasonal_model_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>SARIMAX Results</caption>
<tr>
  <th>Dep. Variable:</th>      <td>avg_crimes</td>    <th>  No. Observations:  </th>    <td>57</td>   
</tr>
<tr>
  <th>Model:</th>           <td>SARIMAX(9, 1, 6)</td> <th>  Log Likelihood     </th> <td>-204.780</td>
</tr>
<tr>
  <th>Date:</th>            <td>Sat, 10 Dec 2022</td> <th>  AIC                </th>  <td>441.559</td>
</tr>
<tr>
  <th>Time:</th>                <td>05:18:28</td>     <th>  BIC                </th>  <td>473.965</td>
</tr>
<tr>
  <th>Sample:</th>             <td>01-01-2017</td>    <th>  HQIC               </th>  <td>454.123</td>
</tr>
<tr>
  <th></th>                   <td>- 09-01-2021</td>   <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>        <td>opg</td>       <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
     <td></td>       <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>ar.L1</th>  <td>   -0.6784</td> <td>    0.424</td> <td>   -1.600</td> <td> 0.110</td> <td>   -1.509</td> <td>    0.153</td>
</tr>
<tr>
  <th>ar.L2</th>  <td>   -0.2933</td> <td>    0.402</td> <td>   -0.730</td> <td> 0.465</td> <td>   -1.080</td> <td>    0.494</td>
</tr>
<tr>
  <th>ar.L3</th>  <td>    0.0143</td> <td>    0.510</td> <td>    0.028</td> <td> 0.978</td> <td>   -0.985</td> <td>    1.013</td>
</tr>
<tr>
  <th>ar.L4</th>  <td>   -0.0773</td> <td>    0.349</td> <td>   -0.221</td> <td> 0.825</td> <td>   -0.762</td> <td>    0.607</td>
</tr>
<tr>
  <th>ar.L5</th>  <td>   -0.3631</td> <td>    0.344</td> <td>   -1.056</td> <td> 0.291</td> <td>   -1.037</td> <td>    0.311</td>
</tr>
<tr>
  <th>ar.L6</th>  <td>   -0.8369</td> <td>    0.335</td> <td>   -2.501</td> <td> 0.012</td> <td>   -1.493</td> <td>   -0.181</td>
</tr>
<tr>
  <th>ar.L7</th>  <td>   -0.3752</td> <td>    0.286</td> <td>   -1.312</td> <td> 0.189</td> <td>   -0.936</td> <td>    0.185</td>
</tr>
<tr>
  <th>ar.L8</th>  <td>   -0.3143</td> <td>    0.233</td> <td>   -1.350</td> <td> 0.177</td> <td>   -0.771</td> <td>    0.142</td>
</tr>
<tr>
  <th>ar.L9</th>  <td>   -0.4757</td> <td>    0.205</td> <td>   -2.318</td> <td> 0.020</td> <td>   -0.878</td> <td>   -0.073</td>
</tr>
<tr>
  <th>ma.L1</th>  <td>    0.4039</td> <td>    0.754</td> <td>    0.536</td> <td> 0.592</td> <td>   -1.073</td> <td>    1.881</td>
</tr>
<tr>
  <th>ma.L2</th>  <td>   -0.0616</td> <td>    1.760</td> <td>   -0.035</td> <td> 0.972</td> <td>   -3.511</td> <td>    3.388</td>
</tr>
<tr>
  <th>ma.L3</th>  <td>   -0.4458</td> <td>    0.627</td> <td>   -0.711</td> <td> 0.477</td> <td>   -1.674</td> <td>    0.782</td>
</tr>
<tr>
  <th>ma.L4</th>  <td>   -0.0698</td> <td>    1.656</td> <td>   -0.042</td> <td> 0.966</td> <td>   -3.315</td> <td>    3.176</td>
</tr>
<tr>
  <th>ma.L5</th>  <td>    0.4061</td> <td>    1.000</td> <td>    0.406</td> <td> 0.685</td> <td>   -1.554</td> <td>    2.366</td>
</tr>
<tr>
  <th>ma.L6</th>  <td>    0.8988</td> <td>    1.440</td> <td>    0.624</td> <td> 0.533</td> <td>   -1.924</td> <td>    3.721</td>
</tr>
<tr>
  <th>sigma2</th> <td>   71.1447</td> <td>   88.095</td> <td>    0.808</td> <td> 0.419</td> <td> -101.519</td> <td>  243.808</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Ljung-Box (L1) (Q):</th>     <td>0.20</td> <th>  Jarque-Bera (JB):  </th> <td>6.26</td> 
</tr>
<tr>
  <th>Prob(Q):</th>                <td>0.66</td> <th>  Prob(JB):          </th> <td>0.04</td> 
</tr>
<tr>
  <th>Heteroskedasticity (H):</th> <td>2.71</td> <th>  Skew:              </th> <td>-0.59</td>
</tr>
<tr>
  <th>Prob(H) (two-sided):</th>    <td>0.04</td> <th>  Kurtosis:          </th> <td>4.13</td> 
</tr>
</table><br/><br/>Warnings:<br/>[1] Covariance matrix calculated using the outer product of gradients (complex-step).</div></div>
</div>
<p>Again the model meets the condition of independence in the residuals because the p-value of the Ljung-Box test (<code class="docutils literal notranslate"><span class="pre">Prob(Q):</span> <span class="pre">0.66</span></code>) is greater than 0.05, so we cannot reject the null hypothesis of independence. We also cannot say that the residual distribution is homoscedastic because the p-value of the Heteroskedasticity test (<code class="docutils literal notranslate"><span class="pre">Prob(H):</span> <span class="pre">0.04</span></code>) is smaller than 0.05.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">seasonal_model_fit</span><span class="o">.</span><span class="n">plot_diagnostics</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_157_0.png" src="_images/intro_157_0.png" />
</div>
</div>
<p>The standardized residual errors seem to fluctuate around a mean of zero and have a uniform variance. The density plot suggest normal distribution with mean zero and overlapping N(0,1). The Q-Q plot of the residuals implies that the residuals follow a linear trend with skewed tails. Thus, the residuals are normally distributed. The Correlogram, plot shows the residual errors are not autocorrelated.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_test</span> <span class="o">=</span> <span class="n">ts_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">seasonal_pred</span> <span class="o">=</span> <span class="n">seasonal_model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">n_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="decomposed-sarima-prediction">
<h3>Decomposed SARIMA Prediction<a class="headerlink" href="#decomposed-sarima-prediction" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">seasonal_pred_score</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">seasonal_pred</span><span class="p">)</span>
<span class="n">nrmse</span> <span class="o">=</span> <span class="n">rmse</span><span class="p">(</span><span class="n">seasonal_pred_score</span><span class="p">,</span> <span class="n">ts_test</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ts_test</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ts_test</span><span class="p">))</span>
<span class="n">smape</span> <span class="o">=</span> <span class="n">SMAPE</span><span class="p">(</span><span class="n">ts_test</span><span class="o">.</span><span class="n">avg_crimes</span><span class="p">,</span> <span class="n">seasonal_pred</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MSE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">seasonal_pred</span><span class="p">),</span> <span class="mi">3</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nrmse</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R^2: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">seasonal_pred</span><span class="p">),</span> <span class="mi">6</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SMAPE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span> <span class="nb">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">smape</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MSE: 202.843
RMSE: 0.202248
R^2: 0.570539
SMAPE: 0.057084
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="decomposed-sarima-prediction-plot">
<h3>Decomposed SARIMA Prediction Plot<a class="headerlink" href="#decomposed-sarima-prediction-plot" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">seasonal_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Decomposed SARIMA Prediction Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average Number of Crimes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_163_0.png" src="_images/intro_163_0.png" />
</div>
</div>
</div>
<div class="section" id="decomposed-sarima-forecast">
<h3>Decomposed SARIMA Forecast<a class="headerlink" href="#decomposed-sarima-forecast" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">seasonal_sarima_forecast</span> <span class="o">=</span> <span class="n">seasonal_model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">n_test</span><span class="o">+</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">seasonal_sarima_forecast</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Decomposed SARIMA Forecast&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average Number of Crimes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_166_0.png" src="_images/intro_166_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="multi-step-decomposed-sarima">
<h2>Multi-Step Decomposed SARIMA<a class="headerlink" href="#multi-step-decomposed-sarima" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_seasonal</span> <span class="o">=</span> <span class="n">SARIMAX</span><span class="p">(</span><span class="n">ts_train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">q</span><span class="p">),</span> <span class="n">seasonal_order</span><span class="o">=</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">model_fit_seasonal</span> <span class="o">=</span> <span class="n">model_seasonal</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">model_fit_seasonal</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>SARIMAX Results</caption>
<tr>
  <th>Dep. Variable:</th>                         <td>avg_crimes</td>                       <th>  No. Observations:  </th>    <td>57</td>   
</tr>
<tr>
  <th>Model:</th>           <td>SARIMAX(9, 1, 6)x(12, 0, [1, 2, 3, 4, 5, 6, 7, 8], 12)</td> <th>  Log Likelihood     </th> <td>-202.422</td>
</tr>
<tr>
  <th>Date:</th>                               <td>Sat, 10 Dec 2022</td>                    <th>  AIC                </th>  <td>476.843</td>
</tr>
<tr>
  <th>Time:</th>                                   <td>05:23:20</td>                        <th>  BIC                </th>  <td>549.756</td>
</tr>
<tr>
  <th>Sample:</th>                                <td>01-01-2017</td>                       <th>  HQIC               </th>  <td>505.111</td>
</tr>
<tr>
  <th></th>                                      <td>- 09-01-2021</td>                      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>                           <td>opg</td>                          <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
      <td></td>         <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>ar.L1</th>     <td>   -0.7544</td> <td>    3.047</td> <td>   -0.248</td> <td> 0.804</td> <td>   -6.726</td> <td>    5.217</td>
</tr>
<tr>
  <th>ar.L2</th>     <td>   -0.3967</td> <td>    8.304</td> <td>   -0.048</td> <td> 0.962</td> <td>  -16.673</td> <td>   15.879</td>
</tr>
<tr>
  <th>ar.L3</th>     <td>   -0.0790</td> <td>    4.082</td> <td>   -0.019</td> <td> 0.985</td> <td>   -8.080</td> <td>    7.922</td>
</tr>
<tr>
  <th>ar.L4</th>     <td>   -0.0707</td> <td>    9.479</td> <td>   -0.007</td> <td> 0.994</td> <td>  -18.650</td> <td>   18.508</td>
</tr>
<tr>
  <th>ar.L5</th>     <td>   -0.3158</td> <td>    3.815</td> <td>   -0.083</td> <td> 0.934</td> <td>   -7.793</td> <td>    7.162</td>
</tr>
<tr>
  <th>ar.L6</th>     <td>   -0.8272</td> <td>    5.454</td> <td>   -0.152</td> <td> 0.879</td> <td>  -11.516</td> <td>    9.862</td>
</tr>
<tr>
  <th>ar.L7</th>     <td>   -0.4928</td> <td>    1.983</td> <td>   -0.248</td> <td> 0.804</td> <td>   -4.380</td> <td>    3.394</td>
</tr>
<tr>
  <th>ar.L8</th>     <td>   -0.4103</td> <td>    2.695</td> <td>   -0.152</td> <td> 0.879</td> <td>   -5.693</td> <td>    4.872</td>
</tr>
<tr>
  <th>ar.L9</th>     <td>   -0.5465</td> <td>    4.648</td> <td>   -0.118</td> <td> 0.906</td> <td>   -9.657</td> <td>    8.564</td>
</tr>
<tr>
  <th>ma.L1</th>     <td>    0.4141</td> <td>    4.296</td> <td>    0.096</td> <td> 0.923</td> <td>   -8.006</td> <td>    8.834</td>
</tr>
<tr>
  <th>ma.L2</th>     <td>   -0.0730</td> <td>    4.473</td> <td>   -0.016</td> <td> 0.987</td> <td>   -8.840</td> <td>    8.694</td>
</tr>
<tr>
  <th>ma.L3</th>     <td>   -0.3471</td> <td>    5.144</td> <td>   -0.067</td> <td> 0.946</td> <td>  -10.429</td> <td>    9.735</td>
</tr>
<tr>
  <th>ma.L4</th>     <td>   -0.0265</td> <td>    4.131</td> <td>   -0.006</td> <td> 0.995</td> <td>   -8.124</td> <td>    8.071</td>
</tr>
<tr>
  <th>ma.L5</th>     <td>    0.4325</td> <td>    6.749</td> <td>    0.064</td> <td> 0.949</td> <td>  -12.795</td> <td>   13.659</td>
</tr>
<tr>
  <th>ma.L6</th>     <td>    0.9116</td> <td>    7.403</td> <td>    0.123</td> <td> 0.902</td> <td>  -13.597</td> <td>   15.421</td>
</tr>
<tr>
  <th>ar.S.L12</th>  <td>   -0.1116</td> <td> 1834.079</td> <td>-6.08e-05</td> <td> 1.000</td> <td>-3594.840</td> <td> 3594.617</td>
</tr>
<tr>
  <th>ar.S.L24</th>  <td>    0.0759</td> <td>  550.158</td> <td>    0.000</td> <td> 1.000</td> <td>-1078.214</td> <td> 1078.366</td>
</tr>
<tr>
  <th>ar.S.L36</th>  <td>    0.3806</td> <td> 1246.037</td> <td>    0.000</td> <td> 1.000</td> <td>-2441.808</td> <td> 2442.569</td>
</tr>
<tr>
  <th>ar.S.L48</th>  <td>    0.1899</td> <td>  789.296</td> <td>    0.000</td> <td> 1.000</td> <td>-1546.802</td> <td> 1547.182</td>
</tr>
<tr>
  <th>ar.S.L60</th>  <td>    0.2009</td> <td> 1331.493</td> <td>    0.000</td> <td> 1.000</td> <td>-2609.477</td> <td> 2609.879</td>
</tr>
<tr>
  <th>ar.S.L72</th>  <td>    0.0492</td> <td>  714.288</td> <td> 6.88e-05</td> <td> 1.000</td> <td>-1399.930</td> <td> 1400.028</td>
</tr>
<tr>
  <th>ar.S.L84</th>  <td>   -0.1732</td> <td> 2184.443</td> <td>-7.93e-05</td> <td> 1.000</td> <td>-4281.604</td> <td> 4281.257</td>
</tr>
<tr>
  <th>ar.S.L96</th>  <td>   -0.1912</td> <td> 1160.057</td> <td>   -0.000</td> <td> 1.000</td> <td>-2273.860</td> <td> 2273.478</td>
</tr>
<tr>
  <th>ar.S.L108</th> <td>   -0.1507</td> <td> 1918.738</td> <td>-7.85e-05</td> <td> 1.000</td> <td>-3760.809</td> <td> 3760.508</td>
</tr>
<tr>
  <th>ar.S.L120</th> <td>    0.0216</td> <td> 2479.574</td> <td> 8.69e-06</td> <td> 1.000</td> <td>-4859.855</td> <td> 4859.898</td>
</tr>
<tr>
  <th>ar.S.L132</th> <td>    0.0921</td> <td> 3025.476</td> <td> 3.05e-05</td> <td> 1.000</td> <td>-5929.732</td> <td> 5929.916</td>
</tr>
<tr>
  <th>ar.S.L144</th> <td>    0.1035</td> <td>  867.946</td> <td>    0.000</td> <td> 1.000</td> <td>-1701.039</td> <td> 1701.246</td>
</tr>
<tr>
  <th>ma.S.L12</th>  <td>   -0.0608</td> <td> 1660.194</td> <td>-3.66e-05</td> <td> 1.000</td> <td>-3253.981</td> <td> 3253.860</td>
</tr>
<tr>
  <th>ma.S.L24</th>  <td>   -0.0794</td> <td>  724.125</td> <td>   -0.000</td> <td> 1.000</td> <td>-1419.338</td> <td> 1419.179</td>
</tr>
<tr>
  <th>ma.S.L36</th>  <td>    0.2451</td> <td> 1318.586</td> <td>    0.000</td> <td> 1.000</td> <td>-2584.136</td> <td> 2584.626</td>
</tr>
<tr>
  <th>ma.S.L48</th>  <td>   -0.0836</td> <td> 2462.461</td> <td>-3.39e-05</td> <td> 1.000</td> <td>-4826.418</td> <td> 4826.251</td>
</tr>
<tr>
  <th>ma.S.L60</th>  <td>   -0.0982</td> <td> 1208.073</td> <td>-8.13e-05</td> <td> 1.000</td> <td>-2367.877</td> <td> 2367.681</td>
</tr>
<tr>
  <th>ma.S.L72</th>  <td>   -0.1208</td> <td>  650.225</td> <td>   -0.000</td> <td> 1.000</td> <td>-1274.539</td> <td> 1274.297</td>
</tr>
<tr>
  <th>ma.S.L84</th>  <td>   -0.0341</td> <td> 1652.688</td> <td>-2.06e-05</td> <td> 1.000</td> <td>-3239.243</td> <td> 3239.175</td>
</tr>
<tr>
  <th>ma.S.L96</th>  <td>   -0.1338</td> <td> 2559.645</td> <td>-5.23e-05</td> <td> 1.000</td> <td>-5016.946</td> <td> 5016.678</td>
</tr>
<tr>
  <th>sigma2</th>    <td>   47.8358</td> <td>  217.398</td> <td>    0.220</td> <td> 0.826</td> <td> -378.256</td> <td>  473.927</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Ljung-Box (L1) (Q):</th>     <td>0.09</td> <th>  Jarque-Bera (JB):  </th> <td>13.82</td>
</tr>
<tr>
  <th>Prob(Q):</th>                <td>0.77</td> <th>  Prob(JB):          </th> <td>0.00</td> 
</tr>
<tr>
  <th>Heteroskedasticity (H):</th> <td>2.48</td> <th>  Skew:              </th> <td>-0.74</td>
</tr>
<tr>
  <th>Prob(H) (two-sided):</th>    <td>0.05</td> <th>  Kurtosis:          </th> <td>4.94</td> 
</tr>
</table><br/><br/>Warnings:<br/>[1] Covariance matrix calculated using the outer product of gradients (complex-step).<br/>[2] Covariance matrix is singular or near-singular, with condition number 3.23e+19. Standard errors may be unstable.</div></div>
</div>
<p>The Multi-Step SARIMA model meets the condition of independence in the residuals because the p-value of the Ljung-Box test (<code class="docutils literal notranslate"><span class="pre">Prob(Q):</span> <span class="pre">0.09</span></code>) is greater than 0.05, so we cannot reject the null hypothesis of independence. This time the residual distribution is homoscedastic because the p-value of the Heteroskedasticity test (<code class="docutils literal notranslate"><span class="pre">Prob(H):</span> <span class="pre">0.05</span></code>) is equal than 0.05 indicating that the model explains better the variance in the data. This model outperforms the previous ones in terms of dependability. This demonstrates that SARIMA is superior for short-term forecasting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_fit_seasonal</span><span class="o">.</span><span class="n">plot_diagnostics</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_170_0.png" src="_images/intro_170_0.png" />
</div>
</div>
<p>Again, the plots show that the residuals are not correlated. The standardized residuals model seems similar to the previous one but as we have seen in the model summary this model is more reliable because we can’t reject the null hypothesis of homoscedasticity. The qq-plot follows the linear trend of the samples taken from a standard normal distribution with N(0, 1). This is a strong indication that the residuals are normally distributed.</p>
<div class="section" id="multi-step-decomposed-sarima-prediction">
<h3>Multi-Step Decomposed SARIMA Prediction<a class="headerlink" href="#multi-step-decomposed-sarima-prediction" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_pred_seasonal</span> <span class="o">=</span> <span class="n">model_fit_seasonal</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">n_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_pred_seasonal_score</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ts_pred_seasonal</span><span class="p">)</span>
<span class="n">seasonal_nrmse</span> <span class="o">=</span> <span class="n">rmse</span><span class="p">(</span><span class="n">ts_pred_seasonal_score</span><span class="p">,</span> <span class="n">ts_test</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ts_test</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ts_test</span><span class="p">))</span>
<span class="n">smape</span> <span class="o">=</span> <span class="n">SMAPE</span><span class="p">(</span><span class="n">ts_test</span><span class="o">.</span><span class="n">avg_crimes</span><span class="p">,</span> <span class="n">ts_pred_seasonal</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MSE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">ts_pred_seasonal</span><span class="p">),</span> <span class="mi">3</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Normalized RMSE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">seasonal_nrmse</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R^2: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">ts_pred_seasonal</span><span class="p">),</span><span class="mi">6</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SMAPE: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span> <span class="nb">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">smape</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MSE: 150.764
Normalized RMSE: 0.174362
R^2: 0.680801
SMAPE: 0.048841
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="multi-step-decomposed-sarima-prediction-plot">
<h3>Multi-Step Decomposed SARIMA Prediction Plot<a class="headerlink" href="#multi-step-decomposed-sarima-prediction-plot" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">ts_pred_seasonal</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Multi-Step Decomposed SARIMA Prediction Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average Number of Crimes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_176_0.png" src="_images/intro_176_0.png" />
</div>
</div>
</div>
<div class="section" id="multi-step-decomposed-sarima-forecast">
<h3>Multi-Step Decomposed SARIMA Forecast<a class="headerlink" href="#multi-step-decomposed-sarima-forecast" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">multi_seasonal_forecast</span> <span class="o">=</span> <span class="n">model_fit_seasonal</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">n_test</span><span class="o">+</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">multi_seasonal_forecast</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction with P,D,Q&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Multi-Step Decomposed SARIMA Forecast&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average Number of Crimes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_179_0.png" src="_images/intro_179_0.png" />
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="prediction-results">
<h1>Prediction Results<a class="headerlink" href="#prediction-results" title="Permalink to this headline">¶</a></h1>
<center>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Model</p></th>
<th class="text-align:center head"><p>MSE</p></th>
<th class="text-align:center head"><p>NRMSE</p></th>
<th class="text-align:center head"><p>R^2</p></th>
<th class="text-align:center head"><p>SMAPE</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>Base SARIMA</p></td>
<td class="text-align:center"><p>202.843</p></td>
<td class="text-align:center"><p>20.22%</p></td>
<td class="text-align:center"><p>57.05%</p></td>
<td class="text-align:center"><p>5.70%</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>Single-Step SARIMA</p></td>
<td class="text-align:center"><p>198.395</p></td>
<td class="text-align:center"><p>20.00%</p></td>
<td class="text-align:center"><p>57.99%</p></td>
<td class="text-align:center"><p>0.10%</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>AutoRegressive</p></td>
<td class="text-align:center"><p>184.115</p></td>
<td class="text-align:center"><p>19.26%</p></td>
<td class="text-align:center"><p>61.01%</p></td>
<td class="text-align:center"><p>5.18%</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>Stepwise Auto ARIMA</p></td>
<td class="text-align:center"><p>139.009</p></td>
<td class="text-align:center"><p>16.74%</p></td>
<td class="text-align:center"><p>70.56%</p></td>
<td class="text-align:center"><p>4.02%</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>Seasonal Decomposed Auto ARIMA</p></td>
<td class="text-align:center"><p>156.438</p></td>
<td class="text-align:center"><p>17.76%</p></td>
<td class="text-align:center"><p>66.86%</p></td>
<td class="text-align:center"><p>4.57%</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>Decomposed SARIMA</p></td>
<td class="text-align:center"><p>202.843</p></td>
<td class="text-align:center"><p>20.22%</p></td>
<td class="text-align:center"><p>57.05%</p></td>
<td class="text-align:center"><p>5.70%</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>Multi-Step Decomposed SARIMA</p></td>
<td class="text-align:center"><p>150.765</p></td>
<td class="text-align:center"><p>17.43%</p></td>
<td class="text-align:center"><p>68.08%</p></td>
<td class="text-align:center"><p>4.88%</p></td>
</tr>
</tbody>
</table>
</center>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="prediction-plot-analysis">
<h1>Prediction Plot Analysis<a class="headerlink" href="#prediction-plot-analysis" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">PLT</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">PLT</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">421</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">base_sarima_pred_score</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Base SARIMA Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">422</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_pred_step_df</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Single-Step SARIMA Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">423</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ar_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;AutoRegressive Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">424</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">ts_pred_auto</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Stepwise Auto ARIMA Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax5</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">425</span><span class="p">)</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">ts_pred_decompose</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Decomposed Auto ARIMA Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax6</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">426</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">ts_pred_seasonal</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Decomposed SARIMA Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax7</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">427</span><span class="p">)</span>
<span class="n">ax7</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax7</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">seasonal_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Multi-Step SARIMA Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">ax7</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">PLT</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_182_0.png" src="_images/intro_182_0.png" />
</div>
</div>
<p>Each model performed well in respect to short-term predictions. The Single-Step SARIMA and Multi-Step SARIMA prediction plots provided similar variations to the actual data. The Base SARIMAX model offset the actual data according to the movements.</p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="forecast-comparison">
<h1>Forecast Comparison<a class="headerlink" href="#forecast-comparison" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">PLT</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">PLT</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">421</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">base_sarima_forecast</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Base SARIMA Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">422</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">single_step_forecast</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Single-Step SARIMA Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">423</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ar_forecast</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;AutoRegressive Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">424</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stepwise_forecast</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Stepwise Auto ARIMA Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax5</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">425</span><span class="p">)</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">seasonal_forecast</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Decomposed Auto ARIMA Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax6</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">426</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">seasonal_sarima_forecast</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Decomposed SARIMA Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax7</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">427</span><span class="p">)</span>
<span class="n">ax7</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax7</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">multi_seasonal_forecast</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Multi-Step SARIMA Prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
<span class="n">ax7</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">PLT</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/intro_185_0.png" src="_images/intro_185_0.png" />
</div>
</div>
<ul class="simple">
<li><p>The Stepwise Auto Arima model performed the best in prediction but the forecast indicates the contrary, this leads to believe that the model performs poorly for long-term forecasting.</p></li>
<li><p>The AutoRegressive model indicates the same with poor long-term forecasting as did the Stepwise Auto ARIMA model.</p></li>
<li><p>The Seasonal SARIMA and Multi-Step SARIMA provided good forecasts that ranged similar to the original data.</p></li>
<li><p>The Base SARIMA and and Single-Step SARIMA best reflect long-term relationship with forecasting that reflect the cyclical three year pattern, buth the Single-Setp Multi-Step SARIMA accounted for seasonal trend the best and capture a near perfect SMAPE (0.10%).</p></li>
</ul>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="conclusion">
<h1>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h1>
<p>Crime analysis has exploded among data analysts, data scientists, and enthusiasts recently. This project used Time Series models to predict and forecast crime in the City of Detroit from 2017 until now. Several Time Series models were performed most notably AutoRegressive, Auto ARIMA, and SARIMA models.</p>
<p><strong>In summary</strong>,</p>
<ul class="simple">
<li><p>Data was aggregated into daily crimes and then monthly crimes for analysis.</p></li>
<li><p>The autocorrelation and decomposition plot indicated seasonal trend among the data.</p></li>
<li><p>The Multi-Step SARIMA’s explained the best variance in the data. This model outperforms the previous ones in terms of dependability and demonstrated superior for short-term forecasting.</p></li>
<li><p>The Stepwise Auto ARIMA model performed the well with the highest R^2 70.56%, lowest NRMSE of 16.74%, and a SMAPE of 4.02% but it failed to capture an accurate long-term forecast.</p></li>
<li><p>The Single-Step SARIMA model performed the best in terms of a nero zero SMAPE (0.10%), indicating that this was the ideal model for forecasting.</p></li>
</ul>
<p><em>Note: At the time of this analysis, 2022 has not concluded yet.</em></p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "kyle-w-brown/detroit-crime-prediction-auto-arima",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Kyle W. Brown<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>